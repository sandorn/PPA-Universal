# 阶段一验证指南

**验证日期**: 2025 年 1 月  
**验证目标**: 确认 DI 容器在运行时正常工作

---

## 📋 验证步骤

### 1. 运行项目

1. 在 Visual Studio 中按 `F5` 启动调试，或按 `Ctrl+F5` 启动（不调试）
2. 等待 PowerPoint 启动并加载插件

### 2. 查看日志输出

DI 容器会在插件启动时自动初始化。查看日志输出，应该看到以下消息：

#### ✅ 成功情况

应该看到以下日志消息（按顺序）：

```
插件正在启动
内部启动过程
DI 容器初始化成功
DI 容器测试成功：可以获取 IFormattingConfig 服务
本地PowerPoint应用程序对象为空（或）NetOffice包装器初始化成功
```

#### ❌ 失败情况

如果看到以下消息，说明有问题：

- `初始化 DI 容器失败: [错误信息]` - DI 容器初始化失败
- `DI 容器未初始化` - DI 容器未正确初始化
- `DI 容器测试失败：无法获取 IFormattingConfig 服务` - 服务注册有问题

### 3. 验证功能

1. **检查插件是否正常加载**

   - PowerPoint 功能区应该显示 PPA 插件的自定义选项卡
   - 插件功能应该可以正常使用

2. **测试配置功能**
   - 打开设置窗口（如果插件有设置功能）
   - 确认配置可以正常加载和保存

---

## 🔍 日志查看位置

根据项目配置，日志可能输出到以下位置之一：

1. **Visual Studio 输出窗口**

   - 菜单：视图 → 输出
   - 在"显示输出来源"下拉框中选择"调试"或"PPA"

2. **PowerPoint 即时窗口**

   - 如果使用 `Debug.WriteLine`，可以在即时窗口中查看

3. **日志文件**
   - 如果项目配置了日志文件，检查日志文件位置

---

## ✅ 验证通过标准

- [x] 项目可以成功编译
- [ ] **DI 容器初始化成功**（运行时验证）
- [ ] **DI 容器测试通过**（可以获取 IFormattingConfig 服务）
- [ ] **插件功能正常**（功能区显示，功能可用）

---

## 🐛 常见问题排查

### 问题 1: 看不到日志输出

**解决方案**:

- 检查 `Profiler.LogMessage` 的实现
- 确认日志输出目标（控制台、文件、调试窗口等）
- 检查 Visual Studio 输出窗口的筛选设置

### 问题 2: DI 容器初始化失败

**可能原因**:

- NuGet 包未正确安装
- 程序集引用路径错误
- `FormattingConfig.Instance` 初始化失败

**排查步骤**:

1. 检查 `packages` 文件夹中是否有所有必需的 DLL
2. 检查 `PPA.csproj` 中的引用路径是否正确
3. 查看异常堆栈跟踪，定位具体错误

### 问题 3: 无法获取服务

**可能原因**:

- 服务未正确注册
- 接口实现有问题

**排查步骤**:

1. 检查 `ServiceCollectionExtensions.cs` 中的服务注册代码
2. 确认 `FormattingConfig` 正确实现了 `IFormattingConfig` 接口

---

## 📝 验证结果记录

验证完成后，请记录以下信息：

- **验证日期**: ****\_\_\_****
- **验证人员**: ****\_\_\_****
- **验证结果**: [ ] 通过 [ ] 失败
- **发现的问题**: ****\_\_\_****
- **备注**: ****\_\_\_****

---

## 🚀 验证通过后

验证通过后，可以开始**阶段二：业务层重构**：

1. 将静态类转换为实例类
2. 实现已定义的接口
3. 注册所有服务到 DI 容器
4. 更新 CustomRibbon 使用 DI

---

**当前状态**: ⏳ 等待运行时验证
