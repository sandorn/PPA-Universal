# é˜¶æ®µä¸€ï¼šDIå®¹å™¨åŸºç¡€è®¾æ–½ - å®æ–½è¯´æ˜

## âœ… å·²å®Œæˆçš„å·¥ä½œ

### 1. æ›´æ–° packages.config
- âœ… æ·»åŠ äº† `Microsoft.Extensions.DependencyInjection` (v7.0.0)
- âœ… æ·»åŠ äº† `Microsoft.Extensions.DependencyInjection.Abstractions` (v7.0.0)

### 2. æ›´æ–°é¡¹ç›®æ–‡ä»¶ (PPA.csproj)
- âœ… æ·»åŠ äº† DI å®¹å™¨çš„ç¨‹åºé›†å¼•ç”¨
- âœ… æ·»åŠ äº†æ‰€æœ‰æ–°åˆ›å»ºçš„æ–‡ä»¶åˆ°ç¼–è¯‘åˆ—è¡¨

### 3. åˆ›å»ºçš„æ–‡ä»¶

#### Core/DI/ServiceCollectionExtensions.cs
- DI å®¹å™¨æ‰©å±•æ–¹æ³•
- `AddPPAServices()` æ–¹æ³•ç”¨äºæ³¨å†Œæ‰€æœ‰ PPA æœåŠ¡

#### Core/Abstraction/Business/ ç›®å½•ä¸‹çš„æ¥å£æ–‡ä»¶
- `IFormattingConfig.cs` - æ ¼å¼åŒ–é…ç½®æ¥å£
- `ITableFormatHelper.cs` - è¡¨æ ¼æ ¼å¼åŒ–æ¥å£
- `ITextFormatHelper.cs` - æ–‡æœ¬æ ¼å¼åŒ–æ¥å£
- `IChartFormatHelper.cs` - å›¾è¡¨æ ¼å¼åŒ–æ¥å£
- `ITableBatchHelper.cs` - è¡¨æ ¼æ‰¹é‡æ“ä½œæ¥å£
- `ITextBatchHelper.cs` - æ–‡æœ¬æ‰¹é‡æ“ä½œæ¥å£
- `IChartBatchHelper.cs` - å›¾è¡¨æ‰¹é‡æ“ä½œæ¥å£
- `IAlignHelper.cs` - å¯¹é½å·¥å…·æ¥å£
- `IShapeHelper.cs` - å½¢çŠ¶å·¥å…·æ¥å£

### 4. ä¿®æ”¹çš„æ–‡ä»¶

#### ThisAddIn.cs
- âœ… æ·»åŠ äº† `IServiceProvider _serviceProvider` å­—æ®µ
- âœ… æ·»åŠ äº† `InitializeDIContainer()` æ–¹æ³•
- âœ… åœ¨ `ThisAddIn_Startup()` ä¸­è°ƒç”¨ DI å®¹å™¨åˆå§‹åŒ–
- âœ… åœ¨ `CleanupResources()` ä¸­æ·»åŠ äº† DI å®¹å™¨é‡Šæ”¾é€»è¾‘

#### FormattingConfig.cs
- âœ… å®ç°äº† `IFormattingConfig` æ¥å£

---

## ğŸ“‹ ä¸‹ä¸€æ­¥æ“ä½œ

### 1. å®‰è£… NuGet åŒ…ï¼ˆå¿…éœ€ï¼‰

åœ¨ Visual Studio ä¸­ï¼š

1. **æ–¹æ³•ä¸€ï¼šé€šè¿‡ NuGet åŒ…ç®¡ç†å™¨**
   - å³é”®ç‚¹å‡»é¡¹ç›® â†’ **ç®¡ç† NuGet ç¨‹åºåŒ…**
   - æœç´¢å¹¶å®‰è£…ï¼š
     - `Microsoft.Extensions.DependencyInjection` (ç‰ˆæœ¬ 7.0.0)
     - `Microsoft.Extensions.DependencyInjection.Abstractions` (ç‰ˆæœ¬ 7.0.0)

2. **æ–¹æ³•äºŒï¼šé€šè¿‡åŒ…ç®¡ç†å™¨æ§åˆ¶å°**
   ```powershell
   Install-Package Microsoft.Extensions.DependencyInjection -Version 7.0.0
   Install-Package Microsoft.Extensions.DependencyInjection.Abstractions -Version 7.0.0
   ```

3. **æ–¹æ³•ä¸‰ï¼šè¿˜åŸç°æœ‰åŒ…**
   - å³é”®ç‚¹å‡»è§£å†³æ–¹æ¡ˆ â†’ **è¿˜åŸ NuGet ç¨‹åºåŒ…**
   - Visual Studio ä¼šè‡ªåŠ¨ä¸‹è½½ packages.config ä¸­åˆ—å‡ºçš„åŒ…

### 2. éªŒè¯å®‰è£…

å®‰è£… NuGet åŒ…åï¼Œç¼–è¯‘é¡¹ç›®åº”è¯¥æ²¡æœ‰é”™è¯¯ã€‚å¯ä»¥æ·»åŠ ä¸€ä¸ªç®€å•çš„æµ‹è¯•æ–¹æ³•æ¥éªŒè¯ DI å®¹å™¨ï¼š

```csharp
// åœ¨ ThisAddIn.cs ä¸­æ·»åŠ æµ‹è¯•æ–¹æ³•ï¼ˆå¯é€‰ï¼‰
private void TestDIContainer()
{
    if (_serviceProvider == null)
    {
        Profiler.LogMessage("DI å®¹å™¨æœªåˆå§‹åŒ–");
        return;
    }

    try
    {
        var config = _serviceProvider.GetService<IFormattingConfig>();
        if (config != null)
        {
            Profiler.LogMessage("DI å®¹å™¨æµ‹è¯•æˆåŠŸï¼šå¯ä»¥è·å– IFormattingConfig æœåŠ¡");
        }
        else
        {
            Profiler.LogMessage("DI å®¹å™¨æµ‹è¯•å¤±è´¥ï¼šæ— æ³•è·å– IFormattingConfig æœåŠ¡");
        }
    }
    catch (Exception ex)
    {
        Profiler.LogMessage($"DI å®¹å™¨æµ‹è¯•å¤±è´¥: {ex.Message}");
    }
}
```

åœ¨ `ThisAddIn_Startup()` ä¸­è°ƒç”¨ `TestDIContainer()` è¿›è¡ŒéªŒè¯ã€‚

---

## âœ… éªŒæ”¶æ ‡å‡†

- [ ] NuGet åŒ…å·²å®‰è£…
- [ ] é¡¹ç›®å¯ä»¥æ­£å¸¸ç¼–è¯‘ï¼ˆæ— ç¼–è¯‘é”™è¯¯ï¼‰
- [ ] DI å®¹å™¨å¯ä»¥æ­£å¸¸åˆå§‹åŒ–
- [ ] å¯ä»¥ä» DI å®¹å™¨è·å– `IFormattingConfig` æœåŠ¡
- [ ] æ‰€æœ‰æ ¸å¿ƒä¸šåŠ¡æ¥å£å·²å®šä¹‰

---

## ğŸ“ æ³¨æ„äº‹é¡¹

1. **NuGet åŒ…ç‰ˆæœ¬**: ä½¿ç”¨ 7.0.0 ç‰ˆæœ¬ä»¥ç¡®ä¿ä¸ .NET Framework 4.8 çš„å…¼å®¹æ€§
2. **æ¥å£å®šä¹‰**: å½“å‰æ¥å£ä½¿ç”¨ NetOffice ç±»å‹ï¼Œåç»­é˜¶æ®µå°†æ”¹ä¸ºä½¿ç”¨å¹³å°æŠ½è±¡æ¥å£
3. **æœåŠ¡æ³¨å†Œ**: ç›®å‰åªæ³¨å†Œäº† `IFormattingConfig`ï¼Œå…¶ä»–æœåŠ¡å°†åœ¨é˜¶æ®µäºŒæ³¨å†Œ

---

## ğŸ”„ ä¸‹ä¸€æ­¥ï¼ˆé˜¶æ®µäºŒï¼‰

å®Œæˆé˜¶æ®µä¸€åï¼Œå°†è¿›å…¥é˜¶æ®µäºŒï¼šä¸šåŠ¡å±‚é‡æ„
- å°†é™æ€ç±»è½¬æ¢ä¸ºå®ä¾‹ç±»
- å®ç°å·²å®šä¹‰çš„æ¥å£
- æ³¨å†Œæ‰€æœ‰æœåŠ¡åˆ° DI å®¹å™¨

---

**çŠ¶æ€**: âœ… ä»£ç å·²å®Œæˆï¼Œç­‰å¾…å®‰è£… NuGet åŒ…åéªŒè¯

